
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Signal Quality Evaluation &#8212; MNE-NIRS 0.1.3 dev documentation</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/copybutton.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Frequency and Filter Commentary" href="plot_30_frequency.html" />
    <link rel="prev" title="Artifact Correction Techniques" href="plot_21_artifacts.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-188272121-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../../index.html">
<p class="title">MNE-NIRS</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../changelog.html">
  Changelog
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="dLabelMore" data-toggle="dropdown">
        v0.1.3 dev
        <span class="caret"></span>
    </button>
    <div class="dropdown-menu list-group-flush py-0" aria-labelledby="dLabelMore">
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.1.2/index.html">v0.1.2 (stable)</a>
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.1.1/index.html">v0.1.1</a>
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.1.0/index.html">v0.1.0</a>
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.0.6/index.html">v0.0.6</a>
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.0.5/index.html">v0.0.5</a>
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.0.4/index.html">v0.0.4</a>
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.0.3/index.html">v0.0.3</a>
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.0.2/index.html">v0.0.2</a>
    </div>
</div>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/mne-tools/mne-nirs" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <div class="col-12 col-md-1 col-xl-2 bd-sidebar no-sidebar"></div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-data">
   Import data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scalp-coupling-index">
   Scalp Coupling Index
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sci-evaluated-over-entire-signal">
     SCI evaluated over entire signal
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sci-evaluated-over-initial-segment-of-signal">
     SCI evaluated over initial segment of signal
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sci-evaluated-over-moving-window">
     SCI evaluated over moving window
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#peak-power">
   Peak Power
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduced-noise">
   Introduced Noise
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#peak-power-metric">
   Peak Power Metric
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#annotations">
   Annotations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-11 col-xl-8 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
<p>
  <strong>
    
      <p style="border:3px; border-style:solid; border-color:#24872b; padding: 1em;">
        You are currently reading the latest MNE-NIRS development version documentation.
        If you wish to view the documentation associated with a stable release,
        use the blue dropdown menu in the top right corner of the page.
      </p>
    
  </strong>
</p>

  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-general-plot-22-quality-py"><span class="std std-ref">here</span></a>
to download the full example code or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="signal-quality-evaluation">
<span id="ex-fnirs-quality"></span><span id="sphx-glr-auto-examples-general-plot-22-quality-py"></span><h1>Signal Quality Evaluation<a class="headerlink" href="#signal-quality-evaluation" title="Permalink to this headline">¶</a></h1>
<p>This tutorial demonstrates how signal quality can be evaluated using MNE-NIRS.</p>
<aside class="sidebar">
<p class="sidebar-title">Relevant literature</p>
<p>Pollonini L et al., “PHOEBE: a method for real time mapping of
optodes-scalp coupling in functional near-infrared spectroscopy” in
Biomed. Opt. Express 7, 5104-5119 (2016).</p>
<p>Montero Hernandez, Samuel, and Luca Pollonini. “NIRSplot: a tool for
quality assessment of fNIRS scans.” Optics and the Brain.
Optical Society of America, 2020.</p>
<p>Pollonini, L., Olds, C., Abaya, H., Bortfeld, H., Beauchamp, M. S., &amp;
Oghalai, J. S. (2014). Auditory cortex activation to natural speech and
simulated cochlear implant speech measured with functional near-infrared
spectroscopy. Hearing research, 309, 84-93.</p>
</aside>
<p>Ensuring your data is of high quality is essential to good scientific research.
Evaluating data quality is an essential part of both data collection and
analysis.
For assessing data quality during data acquisition tools such as PHOEBE are
highly recommended, these allow the researcher to address potential problems
immediately and modify their experiment to improve the quality of recorded
data.
It is also important to assess data quality during data analysis.
MNE-Python and MNE-NIRS provides several mechanisms to allow researchers
to evaluate the quality of their data and to include this information in their
downstream processing.
Dedicated tools exist for quality evaluatiuon such as Montero Hernandez (2020).
This tutorial demonstrates methods in MNE-NIRS and MNE-Python for determining
channels with poor signal
quality, and methods for determining time segments of data that are of low
quality in a subset of channels.</p>
<p>Two methods are introduced in this tutorial. The scalp coupling index (SCI)
and peak power (PP) metrics. Both of these methods examine the signal for
the presence of a heart beat signal, which indicates that the sensors
were in contact with the scalp. For further details see the papers listed
in the relevant literature sidebar.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sphinx_gallery_thumbnail_number = 7</span>

<span class="c1"># Authors: Robert Luke &lt;mail@robertluke.net&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: BSD (3-clause)</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <a href="https://docs.python.org/3/library/itertools.html#itertools.compress" title="itertools.compress" class="sphx-glr-backref-module-itertools sphx-glr-backref-type-py-function"><span class="n">compress</span></a>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">mne.preprocessing.nirs</span> <span class="kn">import</span> <a href="https://mne.tools/stable/generated/mne.preprocessing.nirs.optical_density.html#mne.preprocessing.nirs.optical_density" title="mne.preprocessing.nirs.optical_density" class="sphx-glr-backref-module-mne-preprocessing-nirs sphx-glr-backref-type-py-function"><span class="n">optical_density</span></a>
<span class="kn">from</span> <span class="nn">mne_nirs.preprocessing</span> <span class="kn">import</span> <a href="../../generated/mne_nirs.preprocessing.peak_power.html#mne_nirs.preprocessing.peak_power" title="mne_nirs.preprocessing.peak_power" class="sphx-glr-backref-module-mne_nirs-preprocessing sphx-glr-backref-type-py-function"><span class="n">peak_power</span></a><span class="p">,</span> <a href="../../generated/mne_nirs.preprocessing.scalp_coupling_index_windowed.html#mne_nirs.preprocessing.scalp_coupling_index_windowed" title="mne_nirs.preprocessing.scalp_coupling_index_windowed" class="sphx-glr-backref-module-mne_nirs-preprocessing sphx-glr-backref-type-py-function"><span class="n">scalp_coupling_index_windowed</span></a>
<span class="kn">from</span> <span class="nn">mne_nirs.visualisation</span> <span class="kn">import</span> <a href="../../generated/mne_nirs.visualisation.plot_timechannel_quality_metric.html#mne_nirs.visualisation.plot_timechannel_quality_metric" title="mne_nirs.visualisation.plot_timechannel_quality_metric" class="sphx-glr-backref-module-mne_nirs-visualisation sphx-glr-backref-type-py-function"><span class="n">plot_timechannel_quality_metric</span></a>
</pre></div>
</div>
<section id="import-data">
<h2>Import data<a class="headerlink" href="#import-data" title="Permalink to this headline">¶</a></h2>
<p>Here we will work with the <a class="reference external" href="https://mne.tools/stable/overview/datasets_index.html#fnirs-motor-dataset" title="(in MNE v0.24)"><span class="xref std std-ref">fNIRS motor data</span></a>.
We resample the data to make indexing exact times more convenient.
We then convert the data to optical density and plot the raw signal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fnirs_data_folder</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.datasets.fnirs_motor.data_path.html#mne.datasets.fnirs_motor.data_path" title="mne.datasets.fnirs_motor.data_path" class="sphx-glr-backref-module-mne-datasets-fnirs_motor sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">fnirs_motor</span><span class="o">.</span><span class="n">data_path</span></a><span class="p">()</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fnirs_cw_amplitude_dir</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/os.path.html#os.path.join" title="os.path.join" class="sphx-glr-backref-module-os-path sphx-glr-backref-type-py-function"><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span></a><span class="p">(</span><span class="n">fnirs_data_folder</span><span class="p">,</span> <span class="s1">&#39;Participant-1&#39;</span><span class="p">)</span>
<span class="n">raw_intensity</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.io.read_raw_nirx.html#mne.io.read_raw_nirx" title="mne.io.read_raw_nirx" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_raw_nirx</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fnirs_cw_amplitude_dir</span></a><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.load_data" title="mne.io.BaseRaw.load_data" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_intensity</span><span class="o">.</span><span class="n">load_data</span></a><span class="p">()</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">npad</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
<span class="n">raw_od</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.preprocessing.nirs.optical_density.html#mne.preprocessing.nirs.optical_density" title="mne.preprocessing.nirs.optical_density" class="sphx-glr-backref-module-mne-preprocessing-nirs sphx-glr-backref-type-py-function"><span class="n">optical_density</span></a><span class="p">(</span><span class="n">raw_intensity</span><span class="p">)</span>
<a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.plot" title="mne.io.BaseRaw.plot" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_od</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">n_channels</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">show_scrollbars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clipping</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_22_quality_001.png" srcset="../../_images/sphx_glr_plot_22_quality_001.png" alt="plot 22 quality" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Loading /home/runner/mne_data/MNE-fNIRS-motor-data/Participant-1

&lt;MNEBrowseFigure size 800x800 with 4 Axes&gt;
</pre></div>
</div>
<p>From the above plot we observe that the data is relatively clean.
Later we will add some artificial bad sections to demonstrate the quality
evaluation metrics.</p>
</section>
<section id="scalp-coupling-index">
<h2>Scalp Coupling Index<a class="headerlink" href="#scalp-coupling-index" title="Permalink to this headline">¶</a></h2>
<p>The scalp coupling index (SCI) from Pollonini (2016) provides a measure of
the quality of the signal for a channel over a specified
measurement duration. See Pollonini (2016) for further details of the
theory and implementation.</p>
<section id="sci-evaluated-over-entire-signal">
<h3>SCI evaluated over entire signal<a class="headerlink" href="#sci-evaluated-over-entire-signal" title="Permalink to this headline">¶</a></h3>
<p>Here we calculate the SCI for each channel over
the entire signal and view the distribution of values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sci</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.preprocessing.nirs.scalp_coupling_index.html#mne.preprocessing.nirs.scalp_coupling_index" title="mne.preprocessing.nirs.scalp_coupling_index" class="sphx-glr-backref-module-mne-preprocessing-nirs sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">nirs</span><span class="o">.</span><span class="n">scalp_coupling_index</span></a><span class="p">(</span><span class="n">raw_od</span><span class="p">)</span>
<a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">()</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.axes.Axes.hist.html#matplotlib.axes.Axes.hist" title="matplotlib.axes.Axes.hist" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">hist</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sci</span></a><span class="p">)</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.axes.Axes.set.html#matplotlib.axes.Axes.set" title="matplotlib.axes.Axes.set" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set</span></a><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Scalp Coupling Index&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_22_quality_002.png" srcset="../../_images/sphx_glr_plot_22_quality_002.png" alt="plot 22 quality" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[Text(0.5, 23.52222222222222, &#39;Scalp Coupling Index&#39;), Text(33.972222222222214, 0.5, &#39;Count&#39;), (0.0, 1.0)]
</pre></div>
</div>
<p>We observe that most of the channels have a good SCI of 1, but a few channels
have a poorer score. We can list the channels with an SCI below a threshold.
And we can mark these as bad in the MNE data. This way the functions
downstream will know that the data in these channels is bad.
For this example we set the threshold for a bad channel to be SCI &lt; 0.8.
We then print a list of the bad channels and observe their are 10 channels
(five source-detector pairs) that are marked as bad.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://mne.tools/stable/generated/mne.Info.html#mne.Info" title="mne.Info" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw_od</span><span class="o">.</span><span class="n">info</span></a><span class="p">[</span><span class="s1">&#39;bads&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><a href="https://docs.python.org/3/library/itertools.html#itertools.compress" title="itertools.compress" class="sphx-glr-backref-module-itertools sphx-glr-backref-type-py-function"><span class="n">compress</span></a><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.ch_names" title="mne.io.BaseRaw.ch_names" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-property"><span class="n">raw_od</span><span class="o">.</span><span class="n">ch_names</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sci</span></a> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.Info.html#mne.Info" title="mne.Info" class="sphx-glr-backref-module-mne sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw_od</span><span class="o">.</span><span class="n">info</span></a><span class="p">[</span><span class="s1">&#39;bads&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;S1_D1 760&#39;, &#39;S1_D1 850&#39;, &#39;S1_D9 760&#39;, &#39;S1_D9 850&#39;, &#39;S3_D2 760&#39;, &#39;S3_D2 850&#39;, &#39;S5_D5 760&#39;, &#39;S5_D5 850&#39;, &#39;S5_D7 760&#39;, &#39;S5_D7 850&#39;]
</pre></div>
</div>
<p>We can plot the time course of the signal again and note that the bad
channels are now displayed in grey to indicate they are bad.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.plot" title="mne.io.BaseRaw.plot" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_od</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">n_channels</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">show_scrollbars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clipping</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_22_quality_003.png" srcset="../../_images/sphx_glr_plot_22_quality_003.png" alt="plot 22 quality" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;MNEBrowseFigure size 800x800 with 4 Axes&gt;
</pre></div>
</div>
<p>Similarly, we can view the montage diagram and view where on the head
the bad channels were positioned.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.plot_sensors" title="mne.io.BaseRaw.plot_sensors" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_od</span><span class="o">.</span><span class="n">plot_sensors</span></a><span class="p">()</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_22_quality_004.png" srcset="../../_images/sphx_glr_plot_22_quality_004.png" alt="plot 22 quality" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 640x640 with 1 Axes&gt;
</pre></div>
</div>
</section>
<section id="sci-evaluated-over-initial-segment-of-signal">
<h3>SCI evaluated over initial segment of signal<a class="headerlink" href="#sci-evaluated-over-initial-segment-of-signal" title="Permalink to this headline">¶</a></h3>
<p>The scalp coupling index can be calculated over a limited section of
the signal by cropping to the desired section. For example, if you wish to
evaluate the data quality of the first 10 seconds of the signal.
Note that the difference to evaluation of the entire signal was quite subtle,
but this may vary depending on your experimental design and setup.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sci</span></a> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.preprocessing.nirs.scalp_coupling_index.html#mne.preprocessing.nirs.scalp_coupling_index" title="mne.preprocessing.nirs.scalp_coupling_index" class="sphx-glr-backref-module-mne-preprocessing-nirs sphx-glr-backref-type-py-function"><span class="n">mne</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">nirs</span><span class="o">.</span><span class="n">scalp_coupling_index</span></a><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.copy" title="mne.io.BaseRaw.copy" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_od</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">()</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.axes.Axes.hist.html#matplotlib.axes.Axes.hist" title="matplotlib.axes.Axes.hist" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">hist</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sci</span></a><span class="p">)</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.axes.Axes.set.html#matplotlib.axes.Axes.set" title="matplotlib.axes.Axes.set" class="sphx-glr-backref-module-matplotlib-axes sphx-glr-backref-type-py-method"><span class="n">ax</span><span class="o">.</span><span class="n">set</span></a><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Scalp Coupling Index&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_22_quality_005.png" srcset="../../_images/sphx_glr_plot_22_quality_005.png" alt="plot 22 quality" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[Text(0.5, 23.52222222222222, &#39;Scalp Coupling Index&#39;), Text(33.972222222222214, 0.5, &#39;Count&#39;), (0.0, 1.0)]
</pre></div>
</div>
</section>
<section id="sci-evaluated-over-moving-window">
<h3>SCI evaluated over moving window<a class="headerlink" href="#sci-evaluated-over-moving-window" title="Permalink to this headline">¶</a></h3>
<p>The scalp coupling index can be calculated over
windowed chunks of the signal.
This plot is based on the meg bad channel detection figures
available in mne-bids-pipeline.
Black horizontal lines indicate channels that have been marked as bad
(see above).
The color in the left facet shows the raw scores,
The color in the right facet indicates segments that are below the threshold.
This is useful for determining if a channel becomes bad throughout an
experiment. This may occur due to movement dislodging the optode or many
other causes.
In this example we set the time window to be 60 seconds, but the user may
define a window length that is appropriate for the experiment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">times</span></a> <span class="o">=</span> <a href="../../generated/mne_nirs.preprocessing.scalp_coupling_index_windowed.html#mne_nirs.preprocessing.scalp_coupling_index_windowed" title="mne_nirs.preprocessing.scalp_coupling_index_windowed" class="sphx-glr-backref-module-mne_nirs-preprocessing sphx-glr-backref-type-py-function"><span class="n">scalp_coupling_index_windowed</span></a><span class="p">(</span><span class="n">raw_od</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<a href="../../generated/mne_nirs.visualisation.plot_timechannel_quality_metric.html#mne_nirs.visualisation.plot_timechannel_quality_metric" title="mne_nirs.visualisation.plot_timechannel_quality_metric" class="sphx-glr-backref-module-mne_nirs-visualisation sphx-glr-backref-type-py-function"><span class="n">plot_timechannel_quality_metric</span></a><span class="p">(</span><span class="n">raw_od</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">times</span></a><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Scalp Coupling Index &quot;</span>
                                      <span class="s2">&quot;Quality Evaluation&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_22_quality_006.png" srcset="../../_images/sphx_glr_plot_22_quality_006.png" alt="Scalp Coupling Index Quality Evaluation, All Scores, Scores < Limit" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 2000x1120 with 4 Axes&gt;
</pre></div>
</div>
</section>
</section>
<section id="peak-power">
<h2>Peak Power<a class="headerlink" href="#peak-power" title="Permalink to this headline">¶</a></h2>
<p>It may also be informative to view the quality of the signal at a finer
time resolution. The Peak Power metric provides a quality metric evalauted
over a 10 second window. This allows the user to view instances where
a subset of channels may be contaminated by artifacts for a short duration
of the recording.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">raw_od</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">times</span></a> <span class="o">=</span> <a href="../../generated/mne_nirs.preprocessing.peak_power.html#mne_nirs.preprocessing.peak_power" title="mne_nirs.preprocessing.peak_power" class="sphx-glr-backref-module-mne_nirs-preprocessing sphx-glr-backref-type-py-function"><span class="n">peak_power</span></a><span class="p">(</span><span class="n">raw_od</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a href="../../generated/mne_nirs.visualisation.plot_timechannel_quality_metric.html#mne_nirs.visualisation.plot_timechannel_quality_metric" title="mne_nirs.visualisation.plot_timechannel_quality_metric" class="sphx-glr-backref-module-mne_nirs-visualisation sphx-glr-backref-type-py-function"><span class="n">plot_timechannel_quality_metric</span></a><span class="p">(</span><span class="n">raw_od</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">times</span></a><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Peak Power Quality Evaluation&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_22_quality_007.png" srcset="../../_images/sphx_glr_plot_22_quality_007.png" alt="Peak Power Quality Evaluation, All Scores, Scores < Limit" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 2000x1120 with 4 Axes&gt;
</pre></div>
</div>
</section>
<section id="introduced-noise">
<h2>Introduced Noise<a class="headerlink" href="#introduced-noise" title="Permalink to this headline">¶</a></h2>
<p>The above data is quite clean, so here we add some noise to channels to
demonstrate that the algorithm is able to detect bad segments of data.
We add a step like signal at two time instances to mimic an artifact.
We add one artifact to channel S2-D4 at 1000 seconds
and one artifact to channel S5-D13 at 2000 seconds.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add an artifact to channel S2-D4 at time 1000 seconds</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw_od</span><span class="o">.</span><span class="n">_data</span></a><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4000</span><span class="p">:</span><span class="mi">4080</span><span class="p">]</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.linspace.html#numpy.linspace" title="numpy.linspace" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span> <span class="o">+</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw_od</span><span class="o">.</span><span class="n">_data</span></a><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4000</span><span class="p">]</span>

<span class="c1"># Add an artifact to channel S5-D13 at time 2000 seconds</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw_od</span><span class="o">.</span><span class="n">_data</span></a><span class="p">[</span><span class="mi">34</span><span class="p">,</span> <span class="mi">8000</span><span class="p">:</span><span class="mi">8080</span><span class="p">]</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.linspace.html#numpy.linspace" title="numpy.linspace" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span> <span class="o">+</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">raw_od</span><span class="o">.</span><span class="n">_data</span></a><span class="p">[</span><span class="mi">34</span><span class="p">,</span> <span class="mi">8000</span><span class="p">]</span>
</pre></div>
</div>
<p>Next we plot just these channels to demonstrate that indeed an artifact
has been added.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.copy" title="mne.io.BaseRaw.copy" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_od</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">35</span><span class="p">])</span><span class="o">.</span>\
    <span class="n">plot</span><span class="p">(</span><span class="n">n_channels</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">40000</span><span class="p">,</span> <span class="n">show_scrollbars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">clipping</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scalings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fnirs_od&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">})</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_22_quality_008.png" srcset="../../_images/sphx_glr_plot_22_quality_008.png" alt="plot 22 quality" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;MNEBrowseFigure size 800x800 with 4 Axes&gt;
</pre></div>
</div>
</section>
<section id="peak-power-metric">
<h2>Peak Power Metric<a class="headerlink" href="#peak-power-metric" title="Permalink to this headline">¶</a></h2>
<p>To determine specific time and channel instances where data is of low
quality the peak power metric can be utilise (Pollonini, 2016).
Below the peak power is calculated and displayed for all channels.
The default threshold of 0.1 is applied to the quality scores to determine
bad segments of data.
The left facet illustrates the raw quality scores.
The right facet illustrates the channel and time segments that do not meet
the threshold criteria and are marked as bad.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">raw_od</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">times</span></a> <span class="o">=</span> <a href="../../generated/mne_nirs.preprocessing.peak_power.html#mne_nirs.preprocessing.peak_power" title="mne_nirs.preprocessing.peak_power" class="sphx-glr-backref-module-mne_nirs-preprocessing sphx-glr-backref-type-py-function"><span class="n">peak_power</span></a><span class="p">(</span><span class="n">raw_od</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a href="../../generated/mne_nirs.visualisation.plot_timechannel_quality_metric.html#mne_nirs.visualisation.plot_timechannel_quality_metric" title="mne_nirs.visualisation.plot_timechannel_quality_metric" class="sphx-glr-backref-module-mne_nirs-visualisation sphx-glr-backref-type-py-function"><span class="n">plot_timechannel_quality_metric</span></a><span class="p">(</span><span class="n">raw_od</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">times</span></a><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_22_quality_009.png" srcset="../../_images/sphx_glr_plot_22_quality_009.png" alt="Automated noisy channel detection: fNIRS, All Scores, Scores < Limit" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 2000x1120 with 4 Axes&gt;
</pre></div>
</div>
</section>
<section id="annotations">
<h2>Annotations<a class="headerlink" href="#annotations" title="Permalink to this headline">¶</a></h2>
<p>Similar to how entire channels were marked as bad above, the peak power
function annotates the raw data structure to indicate where the bad
segments of data are. If we replot the subset of channels as above we note
that the bad segments are marked in red now, indicating this time section
contained bad data.
Note that although the red line appears as if the bad marking is present
for all channels, this is due to the plotting code. Internally the software
knows that only certain channels had a bad segment, and downstream processing
will only treat the specified bad channels as bad. I.e. when generating
epochs for time 1000 s, no epochs would be generated for channel S2-D4, but
channels would be generated for S5-D13 (as the artifact was only present
on S2-D4).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.copy" title="mne.io.BaseRaw.copy" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_od</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">35</span><span class="p">])</span><span class="o">.</span>\
    <span class="n">plot</span><span class="p">(</span><span class="n">n_channels</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">40000</span><span class="p">,</span> <span class="n">show_scrollbars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">clipping</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scalings</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fnirs_od&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">})</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_22_quality_010.png" srcset="../../_images/sphx_glr_plot_22_quality_010.png" alt="plot 22 quality" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;MNEBrowseFigure size 800x800 with 4 Axes&gt;
</pre></div>
</div>
<p>These channel and time specific annotations are used by downstream
processing. For example, when extracting epochs if a specific channel
has an annotation indicating a bad segment in a specific time window, then
the epochs will be discarded for that specific channel.
Finally, we display the entire time signal after both channel and time
specific quality evaluation. Note that bad channels are now greyed out
and bad time segments are marked in red.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.plot" title="mne.io.BaseRaw.plot" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_od</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">n_channels</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span> <span class="n">show_scrollbars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clipping</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_22_quality_011.png" srcset="../../_images/sphx_glr_plot_22_quality_011.png" alt="plot 22 quality" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;MNEBrowseFigure size 800x800 with 4 Axes&gt;
</pre></div>
</div>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Two data quality metrics were presented and plotted.
One metric for determining a bad channel (scalp coupling index).
And one metric for determining specific time and channel segments that are
bad.
It was demonstrated how bad segments are visualised and how bad segments
are treated in downstream analysis.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  38.559 seconds)</p>
<p><strong>Estimated memory usage:</strong>  20 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-general-plot-22-quality-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/mne-tools/mne-nirs/gh-pages?filepath=notebooks/auto_examples/general/plot_22_quality.ipynb"><img alt="Launch binder" src="../../_images/binder_badge_logo.svg" width="150px" /></a>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/9a9efbce3264d6170ff89f6f3b534f38/plot_22_quality.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_22_quality.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/fd1c2dcceb3f16d91c216f1598b929ae/plot_22_quality.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_22_quality.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>



              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="plot_21_artifacts.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Artifact Correction Techniques</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="plot_30_frequency.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Frequency and Filter Commentary</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020, Robert Luke.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>